<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Krueger - 战术养成计划</title>
    
    <!-- Vue 3 CDN -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    
    <!-- Remix Icons -->
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
    
    <!-- 自定义样式 -->
    <link rel="stylesheet" href="styles.css">
    
    <!-- 网站图标 -->
    <link rel="icon" type="image/x-icon" href="images/favicon.ico">
    
    <!-- PWA 相关 (可选) -->
    <meta name="theme-color" content="#0a0a0a">
    <meta name="description" content="与《使命召唤》中的Krueger进行战术互动养成">
</head>
<body>
    <div id="app">
        <!-- 遮罩层 -->
        <div class="overlay"></div>

        <!-- 音效控制 -->
        <div class="audio-control">
            <div class="audio-btn" @click="toggleAudio">
                <i class="ri-volume-up-fill" v-if="state.audioEnabled"></i>
                <i class="ri-volume-mute-fill" v-else></i>
            </div>
        </div>

        <!-- 状态栏 -->
        <div class="top-bar">
            <div class="status-pill">
                <i class="ri-heart-3-fill heart-icon" :class="{ 'heart-beat': state.loveScore >= 80 }"></i> 
                <span>TRUST: {{ state.loveScore }}%</span>
            </div>
            <div class="status-pill" style="border-color: #555;">
                <i class="ri-radar-line"></i> 
                <span>STATUS: {{ statusText }}</span>
            </div>
        </div>

        <!-- 任务面板 -->
        <div class="mission-panel" v-if="state.showMissions">
            <div class="mission-title"><i class="ri-list-check"></i> DAILY OBJECTIVES</div>
            <div class="mission-item" v-for="(mission, index) in state.missions" :key="index">
                <i class="ri-checkbox-circle-line mission-check" v-if="mission.completed"></i>
                <i class="ri-checkbox-blank-circle-line" v-else></i>
                {{ mission.text }}
            </div>
            <div class="mission-progress">Progress: {{ completedMissions }}/{{ state.missions.length }}</div>
        </div>

        <!-- 立绘 -->
        <div class="character-container">
            <img :src="state.currentImage" class="character-img natural-breathing" :class="{ shake: state.isShaking, blink: state.isBlinking }" alt="Krueger">
        </div>

        <!-- 触摸层 -->
        <div class="touch-layer">
            <div class="touch-zone head-zone" @click="handleTouch('head')"></div>
            <div class="touch-zone shoulder-zone" @click="handleTouch('shoulder')"></div>
            <div class="touch-zone weapon-zone" @click="handleTouch('weapon')"></div>
        </div>

        <!-- 特效 -->
        <div class="effect" v-for="(effect, index) in state.effects" :key="index" :style="{ left: effect.x + 'px', top: effect.y + 'px' }">
            <i class="ri-heart-fill heart-effect" v-if="effect.type === 'heart'"></i>
        </div>

        <!-- 通知 -->
        <div class="notification" v-if="state.notification.show" :style="{ backgroundColor: state.notification.type === 'success' ? 'rgba(20, 40, 20, 0.9)' : 'rgba(40, 20, 20, 0.9)' }">
            {{ state.notification.text }}
        </div>

        <!-- 右侧按钮 -->
        <div class="side-menu">
            <div class="menu-btn" @click="state.showMissions = !state.showMissions"><i class="ri-list-check"></i></div>
            <div class="menu-btn" @click="triggerEvent('gift')"><i class="ri-gift-line"></i></div>
            <div class="menu-btn" @click="triggerEvent('clean')"><i class="ri-sword-line"></i></div>
            <div class="menu-btn" @click="triggerEvent('train')"><i class="ri-run-line"></i></div>
        </div>

        <!-- 对话框 -->
        <div class="control-panel">
            <div class="dialogue-box">
                <div class="name">
                    Krueger // ID: 2-0-2
                    <span v-if="state.isThinking" class="typing-indicator">INPUTTING...</span>
                </div>
                <div class="text">{{ state.displayBuffer }}</div>
            </div>
            <div class="input-group">
                <input type="text" v-model="state.userInput" @keyup.enter="sendMessage" placeholder="输入指令..." :disabled="state.isThinking">
                <button class="send-btn" @click="sendMessage" :disabled="state.isThinking || !state.userInput">SEND</button>
            </div>
        </div>
    </div>

    <!-- JavaScript 文件 -->
    <script src="js/storage.js"></script>
    <script src="js/api.js"></script>
    <script src="js/app.js"></script>
</body>
</html>